---
title: "react-markdownã®syntax highlightã®è¨­å®šãŒv6ã‹ã‚‰å¤‰ã‚ã£ã¦ã„ãŸä»¶"
emoji: "ğŸº"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [React, Markdown]
published: true
---

ç¾åœ¨Next.jsã§è‡ªä½œãƒ–ãƒ­ã‚°ã‚’ä½œæˆä¸­ãªã®ã§ã™ãŒã€ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’htmlã«å¤‰æ›ã—ã¦ãã‚Œã‚‹npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦[react-markdown](https://github.com/remarkjs/react-markdown/tree/main)ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

[react-markdownã®readme.md](https://github.com/remarkjs/react-markdown/blob/main/readme.md)ã«ã¯ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã®ã‚³ãƒ¼ãƒ‰ä¾‹ã‚‚è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

æœ€åˆã¯webä¸Šã®è¨˜äº‹ã®å®Ÿè£…ä¾‹ã‚’å‚è€ƒã«ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã®è¨­å®šã‚’ã—ã¦ã„ãŸã®ã§ã™ãŒã€TypeScriptã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã¨å‹ãŒåˆã‚ãšè­¦å‘ŠãŒå‡ºã‚‹â€¦ã¨ã„ã†çŠ¶æ…‹ã«ãªã‚Šã€ã“ã“ã§ã¯ã˜ã‚ã¦v5ã¨v6ã§æ›¸ãæ–¹ãŒå¤§ããå¤‰ã‚ã£ã¦ã„ã‚‹ã“ã¨ã«æ°—ã¥ãã¾ã—ãŸã€‚

æœ¬è¨˜äº‹ã§ã¯ã€`react-markdown`ã®v6ãƒ»TypeScriptåˆ©ç”¨æ™‚ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã®å®šç¾©æ–¹æ³•ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚


## æº–å‚™

`create-react-app`ã§Reactã‚¢ãƒ—ãƒªã®é››å½¢ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å¿…è¦ãªnpmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```shell
$ yarn add react-markdown react-syntax-highlighter
$ yarn add -D @types/react-syntax-highlighter
```


## v5ã¯`renderers`

v5ã§ã¯`renderers`ã¨ã„ã†propsã§ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã®è¨­å®šã‚’ã—ã¦ã„ã¾ã—ãŸã€‚`renderers.code`ã®å‹ã¯`React.ElementType`ã¨å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€`CodeBlock`ã¨ã„ã†ã‚ˆã†ãªé–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚


å‚è€ƒ: [v5.0.3ã®REAME.md](https://github.com/remarkjs/react-markdown/blob/5.0.3/readme.md#use-custom-renderers-syntax-highlight)

```jsx
import React from "react";
import ReactMarkdown from "react-markdown";
import { Prism as SyntaxHighlighter } from "react-syntax-highlighter";
import { dark } from "react-syntax-highlighter/dist/esm/styles/prism";

const App: React.VFC = () => {
  const renderers = {
    code: CodeBlock,
  };

  // Did you know you can use tildes instead of backticks for code in markdown? âœ¨
  const markdown = `Here is some JavaScript code:

~~~js
console.log('It works!')
~~~
`;

  return <ReactMarkdown renderers={renderers}>{markdown}</ReactMarkdown>;
};

interface CodeBlockProps {
  language: string | null;
  value: string;
}

const CodeBlock: React.VFC<CodeBlockProps> = (props) => {
  return (
    <SyntaxHighlighter style={dark} language={props.language ?? undefined}>
      {props.value}
    </SyntaxHighlighter>
  );
};

export default App;
```

â€» `React.ElementType`ã®å‹å®šç¾©ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚ç…§ãã ã•ã„ã€‚
> React.ElementTypeã¯'span'ã‚„'div'ãªã©HTMLã‚¿ã‚°ã®æ–‡å­—åˆ— | React.ComponentClass | React.FCã¨å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://qiita.com/NeGI1009/items/d38e517f1647ff2000c7


## v6ã¯`components`

v6ã§ã¯`components`ã¨ã„ã†propsã«å¤‰ã‚ã‚Šã€`renderers`ã¯ãªããªã‚Šã¾ã—ãŸã€‚

`components.code`ã¯v5ã®ã‚ˆã†ã«`React.ElementType`ã§ã¯ãªãã€`code: CodeComponent | ReactMarkdownNames`ã¨ã„ã†ç‹¬è‡ªã®å‹ã¨ãªã£ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã®å‹ã‚’`react-markdown/src/ast-to-react`ã‹ã‚‰importã—ã¦`CodeBlock`ã‚’å®šç¾©ã—ã¾ã—ãŸã€‚ã“ã®å‹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãªãã¦ã‚‚è‰¯ã„æ›¸ãæ–¹ãŒã‚ã‚Œã°è‰¯ã„ã®ã§ã™ãŒæ€ã„ä»˜ã‹ãšã€‚ã€‚

```tsx
import React from 'react';
import ReactMarkdown from 'react-markdown';
import {
  CodeComponent,
  ReactMarkdownNames,
} from 'react-markdown/src/ast-to-react';
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';
import { dark } from 'react-syntax-highlighter/dist/esm/styles/prism';

const App: React.VFC = () => {
  const components = {
    code: CodeBlock,
  };

  // Did you know you can use tildes instead of backticks for code in markdown? âœ¨
  const markdown = `Here is some JavaScript code:

~~~js
console.log('It works!')
~~~
`;

  return <ReactMarkdown components={components}>{markdown}</ReactMarkdown>;
};

const CodeBlock: CodeComponent | ReactMarkdownNames = ({
  inline,
  className,
  children,
  ...props
}) => {
  const match = /language-(\w+)/.exec(className || '');
  return !inline && match ? (
    <SyntaxHighlighter style={dark} language={match[1]} PreTag="div" {...props}>
      {String(children).replace(/\n$/, '')}
    </SyntaxHighlighter>
  ) : (
    <code className={className} {...props}>
      {children}
    </code>
  );
};

export default App;
```

ã¡ãªã¿ã«ã€v6ã®README.mdã«ã‚ã‚‹ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã®ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ä»¥ä¸‹ã¨ãªã‚Šã¾ã™ã€‚

Reactã®ESLintã®è¨­å®šã‚’ã—ã¦ã„ã‚‹ã¨[`react/no-children-props`](https://github.com/yannickcr/eslint-plugin-react/blob/master/docs/rules/no-children-prop.md)ã§æ€’ã‚‰ã‚Œã¾ã™ã€‚

```jsx
import React from 'react'
import ReactMarkdown from 'react-markdown'
import {Prism as SyntaxHighlighter} from 'react-syntax-highlighter'
/* Use `â€¦/dist/cjs/â€¦` if youâ€™re not in ESM! */
import {dark} from 'react-syntax-highlighter/dist/esm/styles/prism'
import {render} from 'react-dom'

const components = {
  code({node, inline, className, children, ...props}) {
    const match = /language-(\w+)/.exec(className || '')
    return !inline && match ? (
      <SyntaxHighlighter style={dark} language={match[1]} PreTag="div" children={String(children).replace(/\n$/, '')} {...props} />
    ) : (
      <code className={className} {...props}>
        {children}
      </code>
    )
  }
}

// Did you know you can use tildes instead of backticks for code in markdown? âœ¨
const markdown = `Here is some JavaScript code:

~~~js
console.log('It works!')
~~~
`

render(<ReactMarkdown components={components} children={markdown} />, document.body)
```


## ãŠã‚ã‚Šã«

`react-markdown`ã®ã“ã®å¤‰æ›´ã‚’é€šã—ã¦ã€Œ`React.ElementType`ã¨ã¯ï¼Ÿ`React.ReactNode`ã¨ã¯ï¼Ÿã€ã¨ã„ã£ãŸReactã®å‹å®šç¾©ã«ã¤ã„ã¦èª¿ã¹ç›´ã™ãã£ã‹ã‘ã«ãªã‚Šã¾ã—ãŸãŒã€
å€‹äººçš„ã«ã¯v5ã®æ–¹ãŒã‚ã‹ã‚Šã‚„ã™ã„ãƒ»æ›¸ãã‚„ã™ã„ã‚ˆã†ã«æ„Ÿã˜ã¾ã™ã€‚ã€‚
